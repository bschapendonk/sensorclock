from adafruit_datetime import datetime
import asyncio
import busio
import time


class Clock:
    def __init__(self, i2c_bus: busio.I2C):
        self.i2c = i2c_bus
        self.display_dot = False
        self.ADDR_ALLCALL = 0x70
        self.ADDR_HOUR = 0x71
        self.ADDR_MINUTE = 0x01
        self.ADDR_SECOND = 0x02
        self.AUTO_INCREMENT = 0x80
        self.DIMM_HOUR_BEGIN = 22
        self.DIMM_HOUR_END = 8
        self.MODE1_ALLCALL = 0x01
        self.MODE1_SLEEP = 0x10
        self.MODE1_SUBADDR1 = 0x08
        self.PWM_DEFAULT = 0x44
        self.PWM_DIMM = 0x01
        self.REGISTER_GRPPWM = 0x12
        self.REGISTER_LEDOUT0 = 0x14
        self.REGISTER_MODE1 = 0x00
        self.REGISTER_PWM0 = 0x02

        self.DIGITS = [
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0x00,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0x00,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
            ],
            [
                self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
                0xFF,
                0xFF,
                0xFF,
                0xFF,
                0x00,
            ],
        ]

    def init(self):
        self.i2c.writeto(
            self.ADDR_ALLCALL,
            bytes([self.REGISTER_MODE1, self.MODE1_SUBADDR1 | self.MODE1_ALLCALL]),
        )
        time.sleep_ms(10)
        self.i2c.writeto(
            self.ADDR_ALLCALL, bytes([self.REGISTER_GRPPWM, self.PWM_DEFAULT])
        )
        self.i2c.writeto(
            self.ADDR_ALLCALL,
            bytes(
                [
                    self.REGISTER_PWM0 | self.AUTO_INCREMENT,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                    0x00,
                ]
            ),
        )
        self.i2c.writeto(
            self.ADDR_ALLCALL,
            bytes(
                [self.REGISTER_LEDOUT0 | self.AUTO_INCREMENT, 0xFF, 0xFF, 0xFF, 0xFF]
            ),
        )
        self.i2c.writeto(
            self.ADDR_MINUTE, bytes([self.REGISTER_MODE1, self.MODE1_ALLCALL])
        )
        self.i2c.writeto(
            self.ADDR_HOUR, bytes([self.REGISTER_MODE1, self.MODE1_ALLCALL])
        )

    def tick(self, now: datetime):
        current_second = self.DIGITS[now.second]

        # flash the last second dot every 500ms
        if self.display_dot:
            current_second[11] = 0xFF
            self.display_dot = False
        else:
            self.display_dot = True

        self.i2c.writeto(self.ADDR_SECOND, bytes(current_second))
        self.i2c.writeto(self.ADDR_MINUTE, bytes(self.DIGITS[now.minute]))
        self.i2c.writeto(self.ADDR_HOUR, bytes(self.DIGITS[now.hour]))

        if now.hour < self.DIMM_HOUR_END or now.hour >= self.DIMM_HOUR_BEGIN:
            self.i2c.writeto(
                self.ADDR_ALLCALL, bytes(self.REGISTER_GRPPWM, self.PWM_DIMM)
            )
        else:
            self.i2c.writeto(
                self.ADDR_ALLCALL,
                bytes(self.REGISTER_GRPPWM, self.PWM_DEFAULT),
            )
